# 自定义规则测试指南

## 前提条件
1. 确保插件已启用（Settings -> Tools -> FreeMacInput -> 基本设置 -> 启用插件）
2. 确保显示提示已开启（Settings -> Tools -> FreeMacInput -> 基本设置 -> 显示切换提示）
3. 确保自定义规则已启用（Settings -> Tools -> FreeMacInput -> 自定义规则场景）

## 测试用例 1：中文文字之间切换为中文

### 规则配置
- **规则名称**：中文文字之间切换为中文
- **左匹配规则**：`.*[\u4e00-\u9fa5]$`（以中文字符结尾）
- **右匹配规则**：`^[\u4e00-\u9fa5].*`（以中文字符开头）
- **满足条件**：同时满足
- **目标输入法**：中文

### 测试步骤
1. 在编辑器中创建一个新的 Java 文件（或任意代码文件）
2. 输入以下代码：
   ```java
   String text = "我可以帮助您提高效率";
   ```
3. 将光标移动到"高"和"效"之间（即两个中文字符之间）
4. 观察结果

### 预期结果
- ✅ 输入法自动切换为中文
- ✅ 显示 Toast 提示："自定义规则: 中文文字之间切换为中文"
- ✅ Toast 背景色为浅蓝色（中文模式）
- ✅ 光标颜色变为红色（如果启用了光标颜色功能）

---

## 测试用例 2：英文字母之间切换为英文

### 规则配置
- **规则名称**：英文字母之间切换为英文
- **左匹配规则**：`.*[a-zA-Z]$`（以英文字母结尾）
- **右匹配规则**：`^[a-zA-Z].*`（以英文字母开头）
- **满足条件**：同时满足
- **目标输入法**：英文

### 测试步骤
1. 在编辑器中输入：
   ```java
   String name = "HelloWorld";
   ```
2. 将光标移动到"Hello"和"World"之间（即"o"和"W"之间）
3. 观察结果

### 预期结果
- ✅ 输入法自动切换为英文
- ✅ 显示 Toast 提示："自定义规则: 英文字母之间切换为英文"
- ✅ Toast 背景色为浅灰色（英文模式）
- ✅ 光标颜色变为灰色（如果启用了光标颜色功能）

---

## 测试用例 3：字符串场景中的自定义规则优先级

### 测试目的
验证自定义规则的优先级高于字符串场景规则

### 测试步骤
1. 在编辑器中输入：
   ```java
   String message = "你好世界";
   ```
2. 将光标移动到"好"和"世"之间
3. 观察 Toast 提示内容

### 预期结果
- ✅ 显示的是"自定义规则: 中文文字之间切换为中文"
- ❌ 不应该显示"字符串场景"相关的提示
- 说明：自定义规则优先级高于字符串场景

---

## 调试方法

### 查看日志
1. 打开 IDE 日志：**Help -> Show Log in Finder/Explorer**
2. 打开 `idea.log` 文件
3. 搜索以下关键字：

#### 关键日志 1：检查自定义规则
```
🔍 检查自定义规则: 左侧文本='...', 右侧文本='...'
```
这条日志显示了提取的左右文本内容

#### 关键日志 2：匹配结果
```
✅ 匹配到规则: 中文文字之间切换为中文
```
或
```
❌ 没有匹配的自定义规则
```

#### 关键日志 3：Toast 显示
```
📢 显示自定义规则 Toast: 自定义规则: 中文文字之间切换为中文
```

### 常见问题排查

#### 问题 1：没有显示 Toast
**可能原因**：
- 显示提示功能被关闭
- Toast 被其他窗口遮挡
- 切换过于频繁，触发了冷却机制

**解决方法**：
1. 检查设置：Settings -> FreeMacInput -> 基本设置 -> 显示切换提示
2. 查看日志中是否有"显示自定义规则 Toast"
3. 等待 1-2 秒后再移动光标

#### 问题 2：规则没有匹配
**可能原因**：
- 规则被禁用
- 正则表达式不匹配
- 文件类型或编辑区域限制

**解决方法**：
1. 检查规则是否启用（配置页面中的"开启状态"）
2. 查看日志中的"左侧文本"和"右侧文本"，确认是否符合正则表达式
3. 检查规则的文件类型和编辑区域限制

#### 问题 3：输入法没有切换
**可能原因**：
- 当前已经是目标输入法
- 切换冷却中
- 输入法切换方案配置错误

**解决方法**：
1. 查看日志中的"是否需要切换"和原因
2. 检查输入法切换方案配置（Settings -> FreeMacInput -> 基本设置）
3. 确认系统中已安装目标输入法

---

## 测试清单

- [ ] 测试用例 1：中文文字之间切换为中文
- [ ] 测试用例 2：英文字母之间切换为英文
- [ ] 测试用例 3：自定义规则优先级验证
- [ ] 查看日志确认规则检查过程
- [ ] 确认 Toast 提示正常显示
- [ ] 确认输入法正确切换

---

## 下一步

如果测试发现问题，请提供：
1. 具体的测试步骤
2. 实际结果（截图或描述）
3. 日志文件中的相关内容（搜索"检查自定义规则"附近的日志）

这样我可以快速定位并修复问题。
